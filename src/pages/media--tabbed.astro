---
import Layout from "../layouts/Layout.astro";
import MediaCard from "../components/common/MediaCard.astro";
import { getCollection } from 'astro:content';

const mediaSections = await getCollection('media');
// Sort by a predefined order
const orderedSections = mediaSections.sort((a, b) => {
  const order = ['nyhetsbrev', 'traningsvideor', 'dokument', 'affischer', 'foreningsdokument', 'videogalleri'];
  return order.indexOf(a.data.id) - order.indexOf(b.data.id);
});
---

<Layout
  title="Media - Aikido Dojo Gamlestaden"
  description="Träningsvideor, dokument, affischer och annat material från Aikido Dojo Gamlestaden."
>
  <main class="container mx-auto max-w-6xl px-4 py-2 sm:px-6 lg:px-8">
    <div class="pb-8">
      <h1 class="text-4xl font-serif mb-6">Media</h1>
      
      <!-- Tabbed Interface -->
      <div 
        x-data="{ 
          activeTab: 'nyhetsbrev',
          setTab(tab) { this.activeTab = tab; }
        }"
        class="w-full"
      >
        <!-- Tabs Navigation -->
        <div class="tabs tabs-border tabs-lg overflow-x-auto flex-nowrap border-b border-base-300 mb-8">
          {orderedSections.map((section, index) => (
            <button
              @click={`setTab('${section.data.id}')`}
              :class={`activeTab === '${section.data.id}' && 'tab-active'`}
              class="tab tab-border whitespace-nowrap"
              type="button"
            >
              {section.data.title}
            </button>
          ))}
        </div>

        <!-- Tab Content Panels -->
        {orderedSections.map((section) => (
          <div 
            x-show={`activeTab === '${section.data.id}'`}
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0 translate-y-4"
            x-transition:enter-end="opacity-100 translate-y-0"
            class="w-full"
          >
            <div class="mb-6">
              <h2 class="text-3xl font-serif mb-2">{section.data.title}</h2>
              {section.data.subtitle && (
                <p class="text-base-content/70 text-lg">{section.data.subtitle}</p>
              )}
            </div>
            
            <div class:list={["grid gap-6", section.data.gridCols || "grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"]}>
              {section.data.items.map((card) => (
                <MediaCard
                  href={card.href}
                  title={card.title}
                  thumbnail={card.thumbnail}
                  thumbnailAlt={card.thumbnailAlt}
                  tags={card.tags}
                  isYouTube={card.isYouTube}
                />
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  </main>
</Layout>
