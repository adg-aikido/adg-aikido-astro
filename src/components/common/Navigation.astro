---
import HomeIcon from "../../assets/home-icon-3abd86.svg";
import FacebookIcon from "../../assets/facebook-icon-929f10.svg";
import NavigationDropdown from "./NavigationDropdown.astro";
import ThemeChooser from "./ThemeChooser.astro";
import { discoverPageVariants, buildNavigationConfig } from "../../utils/navigationBuilder";

interface Props {
  currentPath: string;
}

const { currentPath } = Astro.props;

// Base navigation items (without variants)
const baseNavItems = [
  { href: "/", label: "Huvudsidan", icon: "home" },
  { href: "/aikido", label: "Aikido" },
  { href: "/priser", label: "Priser" },
  { href: "/schema", label: "Schema" },
  { href: "/klubben", label: "Klubben" },
  { href: "/media", label: "Media" },
  { href: "/kontakt", label: "Kontakt" },
  { href: "https://www.facebook.com/aikidodojogamlestaden/", label: "Facebook", icon: "facebook", external: true },
];

// Discover page variants at build time
const pageFilesGlob = import.meta.glob('../../pages/**/*.astro');
const pageFiles = Object.entries(pageFilesGlob).map(([path]) => ({ file: path }));
const variantMap = discoverPageVariants(pageFiles);

// Build complete navigation config with variants
const navItems = buildNavigationConfig(baseNavItems, variantMap);
---

<nav class="text-sm">
  <ul class="flex flex-wrap justify-center items-center space-x-6">
    {navItems.map((item) => {
      // Check if current path matches base page or any variant
      const isActive = !item.external && (
        currentPath === item.href ||
        item.variants?.some(v => currentPath === v.href)
      );

      return (
        <li
          class:list={[
            "border-b-4 flex items-center gap-x-1 transition ease-in-out duration-400",
            isActive ? "border-primary-darker" : "border-transparent",
          ]}
        >
          <a
            href={item.href}
            class="btn btn-link text-primary-content font-bold no-underline uppercase"
            aria-label={item.label}
            aria-haspopup={!item.external ? "true" : undefined}
          >
            {item.icon === "home" && <HomeIcon class="size-6" />}
            {item.icon === "facebook" && <FacebookIcon class="size-6" />}
            {!item.icon && item.label}
          </a>
          {/* Show dropdown for all internal navigation items */}
          {!item.external && (
            <NavigationDropdown item={item} currentPath={currentPath} />
          )}
        </li>
      );
    })}
    <li class="flex items-center">
      <ThemeChooser />
    </li>
  </ul>
</nav>
