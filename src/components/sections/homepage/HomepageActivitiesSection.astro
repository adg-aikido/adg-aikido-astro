---
import { getCollection } from 'astro:content';
import { getUpcomingActivities, formatDateTime } from "../../../utils/contentFilters";
import { marked } from "marked";
import { dateVisibilityFilter } from "../../../utils/alpineFilters";

interface Props {
  maxItems?: number;
}

const { maxItems } = Astro.props;

const allActivities = await getCollection('activities');
const activitiesData = allActivities.map(a => a.data);
const activities = getUpcomingActivities(activitiesData, maxItems);
---

<div
  class="p-4 border-2 rounded-lg shadow-lg border-primary/20 backdrop-blur-sm"
>
  <h2 class="mt-1 font-serif text-3xl font-bold leading-tight">
    Kommande aktiviteter
  </h2>
  <ul class="flex flex-col mt-4 space-y-4">
    {
      activities.map((activity, index) => {
        const dateDisplay = formatDateTime(
          activity.dateStart,
          activity.timeStart,
          false
        );
        const descriptionHtml = marked.parse(activity.description);
        
        return (
          <li>
            <div>
              <strong>{dateDisplay}</strong> â€” <em>{activity.title}</em>
            </div>
            <div class="ml-3">
              <div class="mt-1 mb-0" set:html={descriptionHtml} />
            </div>
          </li>
        );
      })
    }
  </ul>
</div>
