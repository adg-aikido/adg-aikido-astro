---
// Visual weekly schedule timeline with illustrated moments
import schema from "../../../data/schema.yaml";

const daysOfWeek = ["Måndag", "Tisdag", "Onsdag", "Torsdag", "Fredag", "Lördag", "Söndag"];
const scheduleDays = schema.schedule.days;

// Create a full week array with empty days
const weekSchedule = daysOfWeek.map(day => {
  const scheduleDay = scheduleDays.find(d => d.day === day);
  return {
    day,
    sessions: scheduleDay?.sessions || []
  };
});
---

<section id="this-week" class="py-20 px-6 bg-gradient-to-br from-base-200 via-base-100 to-base-200">
  <div class="container mx-auto max-w-7xl">
    <!-- Section Header -->
    <div class="mb-16 text-center">
      <div class="inline-block">
        <p class="text-xs tracking-[0.3em] uppercase text-base-content/60 mb-2">Din Träningsresa</p>
        <h2 class="text-5xl md:text-7xl font-bold italic" style="font-family: 'Playfair Display', 'Crimson Pro', Georgia, serif;">
          Veckans Schema
        </h2>
        <div class="h-1 w-24 bg-secondary mx-auto mt-4"></div>
      </div>
    </div>

    <!-- Visual Timeline -->
    <div class="relative">
      <!-- Timeline Line -->
      <div class="hidden lg:block absolute top-1/2 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-base-content/20 to-transparent -translate-y-1/2 z-0"></div>

      <!-- Days Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-7 gap-6 lg:gap-2 relative z-10">
        {weekSchedule.map((dayData, index) => (
          <div 
            class="flex flex-col items-center group"
            x-data="{ hover: false }"
            @mouseenter="hover = true"
            @mouseleave="hover = false"
          >
            <!-- Day Marker -->
            <div class="relative mb-4">
              <div 
                class={`w-16 h-16 rounded-full flex items-center justify-center font-bold transition-all duration-300 ${
                  dayData.sessions.length > 0 
                    ? 'bg-primary text-primary-content shadow-lg group-hover:scale-110 group-hover:shadow-xl' 
                    : 'bg-base-300 text-base-content/30'
                }`}
              >
                {dayData.day.slice(0, 2).toUpperCase()}
              </div>
              
              {dayData.sessions.length > 0 && (
                <div class="absolute -top-1 -right-1 w-5 h-5 bg-secondary rounded-full border-2 border-base-100 flex items-center justify-center">
                  <span class="text-xs font-bold text-secondary-content">{dayData.sessions.length}</span>
                </div>
              )}
            </div>

            <!-- Day Name -->
            <h3 class={`text-lg font-bold mb-3 transition-colors ${
              dayData.sessions.length > 0 ? 'text-base-content' : 'text-base-content/40'
            }`}>
              {dayData.day}
            </h3>

            <!-- Sessions Card (Appears on Hover) -->
            {dayData.sessions.length > 0 ? (
              <div 
                x-show="hover"
                x-transition:enter="transition ease-out duration-200"
                x-transition:enter-start="opacity-0 transform scale-95 -translate-y-2"
                x-transition:enter-end="opacity-100 transform scale-100 translate-y-0"
                class="card card-border bg-base-100 shadow-2xl w-full max-w-xs lg:absolute lg:top-24 lg:left-1/2 lg:-translate-x-1/2"
              >
                <div class="card-body p-4 space-y-3">
                  {dayData.sessions.map((session, sessionIndex) => (
                    <div class="space-y-2" key={sessionIndex}>
                      <div class="flex items-center gap-2">
                        <div class={`badge badge-${session.color || 'neutral'} badge-sm`}></div>
                        <span class="text-xs font-bold text-base-content/60">
                          {session.timeStart} - {session.timeEnd}
                        </span>
                      </div>
                      <h4 class="font-bold text-sm" set:html={session.title}></h4>
                      {session.subtitle && (
                        <p class="text-xs text-base-content/60" set:html={session.subtitle}></p>
                      )}
                    </div>
                  ))}
                </div>
              </div>
            ) : (
              <div class="text-center opacity-0 lg:opacity-100">
                <p class="text-xs text-base-content/30">Ingen träning</p>
              </div>
            )}

            <!-- Mobile Session List (Always Visible on Mobile) -->
            {dayData.sessions.length > 0 && (
              <div class="lg:hidden w-full space-y-2 mt-2">
                {dayData.sessions.map((session, sessionIndex) => (
                  <div class="card card-border bg-base-100 p-3" key={sessionIndex}>
                    <div class="flex items-center gap-2 mb-1">
                      <div class={`badge badge-${session.color || 'neutral'} badge-sm`}></div>
                      <span class="text-xs font-bold text-base-content/60">
                        {session.timeStart} - {session.timeEnd}
                      </span>
                    </div>
                    <h4 class="font-bold text-sm" set:html={session.title}></h4>
                    {session.subtitle && (
                      <p class="text-xs text-base-content/60" set:html={session.subtitle}></p>
                    )}
                  </div>
                ))}
              </div>
            )}
          </div>
        ))}
      </div>
    </div>

    <!-- Bottom CTA -->
    <div class="text-center mt-16">
      <a href="/schema" class="btn btn-primary btn-lg gap-3">
        <span>Se fullständigt schema</span>
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
      </a>
    </div>
  </div>
</section>
